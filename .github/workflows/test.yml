{
  "jobs": {
    "macos-latest": {
      "runs-on": "macos-latest",
      "steps": [
        {
          "uses": "actions/checkout@v2",
          "with": {
            "submodules": "recursive"
          }
        },
        {
          "uses": "cachix/install-nix-action@v17"
        },
        {
          "uses": "ulrikstrid/nix-s3-action@fork",
          "with": {
            "awsAccessKeyId": "${{ secrets.NIX_CACHE_KEY_ID }}",
            "awsSecretAccessKey": "${{ secrets.NIX_CACHE_SECRET_KEY }}",
            "endpoint": "s3://overlays?endpoint=https://7a53c28e9b7a91239f9ed42da04276bc.r2.cloudflarestorage.com",
            "signingKey": "${{ secrets.NIX_CACHE_SIGNING_KEY }}"
          }
        },
        {
          "name": "Run nix-build",
          "run": "nix-build ./nix/ci/test.nix -A native --argstr ocamlVersion ${{ matrix.ocamlVersion }}"
        }
      ],
      "strategy": {
        "fail-fast": false,
        "matrix": {
          "ocamlVersion": [
            "4_13",
            "4_14",
            "5_00"
          ]
        }
      }
    },
    "ubuntu-latest": {
      "runs-on": "ubuntu-latest",
      "steps": [
        {
          "uses": "actions/checkout@v2",
          "with": {
            "submodules": "recursive"
          }
        },
        {
          "uses": "cachix/install-nix-action@v17"
        },
        {
          "uses": "ulrikstrid/nix-s3-action@fork",
          "with": {
            "awsAccessKeyId": "${{ secrets.NIX_CACHE_KEY_ID }}",
            "awsSecretAccessKey": "${{ secrets.NIX_CACHE_SECRET_KEY }}",
            "endpoint": "s3://overlays?endpoint=https://7a53c28e9b7a91239f9ed42da04276bc.r2.cloudflarestorage.com",
            "signingKey": "${{ secrets.NIX_CACHE_SIGNING_KEY }}"
          }
        },
        {
          "name": "Run nix-build",
          "run": "nix-build ./nix/ci/test.nix -A native -A musl64 --argstr ocamlVersion ${{ matrix.ocamlVersion }}"
        }
      ],
      "strategy": {
        "fail-fast": false,
        "matrix": {
          "ocamlVersion": [
            "4_13",
            "4_14",
            "5_00"
          ]
        }
      }
    }
  },
  "name": "Build",
  "on": {
    "pull_request": null,
    "push": {
      "branches": [
        "master"
      ]
    }
  }
}
